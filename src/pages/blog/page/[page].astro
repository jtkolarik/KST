---
import Layout from '../../../layouts/Layout.astro';
import { getPaginatedPosts, getTotalPages, blogPosts, POSTS_PER_PAGE } from '../../../data/blogPosts';

export function getStaticPaths() {
  const totalPages = getTotalPages();
  // Generate paths for pages 2 and beyond (page 1 is handled by /blog)
  return Array.from({ length: totalPages - 1 }, (_, i) => ({
    params: { page: String(i + 2) }
  }));
}

const { page } = Astro.params;
const currentPage = parseInt(page);
const posts = getPaginatedPosts(currentPage);
const totalPages = getTotalPages();

const hasPrevPage = currentPage > 1;
const hasNextPage = currentPage < totalPages;
const prevPageUrl = currentPage === 2 ? '/blog' : `/blog/page/${currentPage - 1}`;
const nextPageUrl = `/blog/page/${currentPage + 1}`;
---

<Layout title={`Blog - Page ${currentPage}`} description="The Nest - Speech therapy tips, resources, and insights for parents. Learn how to support your child's communication development at home.">
  <!-- Header with pattern background -->
  <div class="relative bg-sage-50 py-16">
    <div class="absolute inset-0 opacity-30">
      <img src="/blog-pattern.png" alt="" class="w-full h-full object-cover" />
    </div>
    <div class="relative max-w-3xl mx-auto px-4 text-center">
      <img src="/bird-envelope.png" alt="" class="w-40 h-auto mx-auto mb-6 animate-on-scroll" />
      <h1 class="text-4xl font-bold text-warmgray-700 mb-4 animate-on-scroll">The Nest</h1>
      <p class="text-lg text-warmgray-500 animate-on-scroll">
        Tips, resources, and insights for supporting your child's communication journey.
      </p>
    </div>
  </div>

  <section class="py-16 bg-sage-50/30">
    <div class="max-w-3xl mx-auto px-4">

      <!-- Page indicator -->
      <p class="text-warmgray-400 text-sm mb-8 text-center">Page {currentPage} of {totalPages}</p>

      <!-- Blog Posts -->
      <div class="space-y-8">
        {posts.map((post) => (
          <article class="bg-white rounded-xl overflow-hidden shadow-sm border border-sage-100 hover:shadow-md transition-shadow animate-on-scroll card-hover">
            <a href={`/blog/${post.slug}`} class="block">
              <img src={post.image} alt={post.imageAlt} class="w-full h-48 object-cover" />
              <div class="p-6">
                <h2 class="text-2xl font-semibold text-warmgray-700 mb-2 hover:text-sage-500 transition-colors">
                  {post.title}
                </h2>
                <p class="text-warmgray-400 text-sm mb-3">{post.dateDisplay}</p>
                <p class="text-warmgray-500">
                  {post.description}
                </p>
                <span class="inline-block mt-4 text-sage-500 font-medium hover:text-sage-600 transition-colors">
                  Read more →
                </span>
              </div>
            </a>
          </article>
        ))}
      </div>

      <!-- Pagination -->
      <div class="mt-12 flex justify-center items-center gap-2">
        {hasPrevPage && (
          <a
            href={prevPageUrl}
            class="px-4 py-2 bg-white border border-sage-200 text-warmgray-600 rounded-lg font-medium hover:bg-sage-50 hover:border-sage-300 transition-colors flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Prev
          </a>
        )}

        <a
          href="/blog"
          class={`px-4 py-2 rounded-lg font-medium ${1 === currentPage ? 'bg-sage-400 text-white' : 'bg-white border border-sage-200 text-warmgray-600 hover:bg-sage-50 hover:border-sage-300'} transition-colors`}
        >
          1
        </a>

        {Array.from({ length: totalPages - 1 }, (_, i) => i + 2).map((pageNum) => (
          <a
            href={`/blog/page/${pageNum}`}
            class={`px-4 py-2 rounded-lg font-medium ${pageNum === currentPage ? 'bg-sage-400 text-white' : 'bg-white border border-sage-200 text-warmgray-600 hover:bg-sage-50 hover:border-sage-300'} transition-colors`}
          >
            {pageNum}
          </a>
        ))}

        {hasNextPage && (
          <a
            href={nextPageUrl}
            class="px-4 py-2 bg-white border border-sage-200 text-warmgray-600 rounded-lg font-medium hover:bg-sage-50 hover:border-sage-300 transition-colors flex items-center gap-1"
          >
            Next
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        )}
      </div>

      <!-- View All Posts Link -->
      <div class="mt-6 text-center">
        <a href="/blog/archive" class="text-sage-500 hover:text-sage-600 font-medium text-sm">
          View all {blogPosts.length} posts →
        </a>
      </div>

      <!-- Branch Divider -->
      <div class="my-16 flex justify-center animate-on-scroll">
        <img src="/branch-divider.png" alt="" class="w-96 h-auto opacity-60" />
      </div>

      <!-- Newsletter Subscribe Section -->
      <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-sage-100 animate-on-scroll card-hover">
        <h2 class="text-2xl font-semibold text-warmgray-700 mb-2">Stay in the Loop</h2>
        <p class="text-warmgray-500 mb-6">
          Get speech therapy tips and resources delivered to your inbox.
        </p>
        <form
          action="https://app.kit.com/forms/8889095/subscriptions"
          method="post"
          class="max-w-md mx-auto"
        >
          <div class="flex flex-col sm:flex-row gap-3">
            <input
              type="email"
              name="email_address"
              placeholder="Enter your email"
              required
              class="flex-1 px-4 py-3 rounded-lg border border-sage-200 focus:border-sage-400 focus:ring-2 focus:ring-sage-100 outline-none transition-colors"
            />
            <button
              type="submit"
              class="bg-sage-400 text-white px-6 py-3 rounded-lg font-semibold hover:bg-sage-500 transition-colors"
            >
              Subscribe
            </button>
          </div>
        </form>
        <p class="text-sm text-warmgray-400 mt-4">No spam, unsubscribe anytime.</p>
      </div>

    </div>
  </section>
</Layout>
