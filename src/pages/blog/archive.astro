---
import Layout from '../../layouts/Layout.astro';
import { blogPosts } from '../../data/blogPosts';

// Group posts by year
const postsByYear = blogPosts.reduce((acc, post) => {
  const year = new Date(post.date).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof blogPosts>);

const years = Object.keys(postsByYear).map(Number).sort((a, b) => b - a);
---

<Layout title="Blog Archive" description="Browse all speech therapy articles and resources from The Nest blog.">
  <!-- Header with pattern background -->
  <div class="relative bg-sage-50 py-16">
    <div class="absolute inset-0 opacity-30">
      <img src="/blog-pattern.png" alt="" class="w-full h-full object-cover" />
    </div>
    <div class="relative max-w-3xl mx-auto px-4 text-center">
      <a href="/blog" class="text-sage-500 hover:text-sage-600 text-sm font-medium mb-4 inline-block">‚Üê Back to Blog</a>
      <h1 class="text-4xl font-bold text-warmgray-700 mb-4 animate-on-scroll">Blog Archive</h1>
      <p class="text-lg text-warmgray-500 animate-on-scroll">
        All {blogPosts.length} articles from The Nest
      </p>
    </div>
  </div>

  <section class="py-16 bg-sage-50/30">
    <div class="max-w-3xl mx-auto px-4">

      {years.map((year) => (
        <div class="mb-12">
          <h2 class="text-2xl font-bold text-warmgray-700 mb-6 pb-2 border-b border-sage-200">{year}</h2>
          <div class="space-y-4">
            {postsByYear[year].map((post) => (
              <a
                href={`/blog/${post.slug}`}
                class="block bg-white rounded-lg p-4 border border-sage-100 hover:border-sage-300 hover:shadow-sm transition-all group"
              >
                <div class="flex items-start gap-4">
                  <img
                    src={post.image}
                    alt={post.imageAlt}
                    class="w-20 h-20 object-cover rounded-lg flex-shrink-0"
                  />
                  <div class="flex-1 min-w-0">
                    <h3 class="text-lg font-semibold text-warmgray-700 group-hover:text-sage-500 transition-colors mb-1">
                      {post.title}
                    </h3>
                    <p class="text-warmgray-400 text-sm mb-2">{post.dateDisplay}</p>
                    <p class="text-warmgray-500 text-sm line-clamp-2">
                      {post.description}
                    </p>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      ))}

      <!-- Branch Divider -->
      <div class="my-16 flex justify-center animate-on-scroll">
        <img src="/branch-divider.png" alt="" class="w-96 h-auto opacity-60" />
      </div>

      <!-- Newsletter Subscribe Section -->
      <div class="bg-white rounded-xl p-8 text-center shadow-sm border border-sage-100 animate-on-scroll card-hover">
        <h2 class="text-2xl font-semibold text-warmgray-700 mb-2">Stay in the Loop</h2>
        <p class="text-warmgray-500 mb-6">
          Get speech therapy tips and resources delivered to your inbox.
        </p>
        <form
          action="https://app.kit.com/forms/8889095/subscriptions"
          method="post"
          class="max-w-md mx-auto"
        >
          <div class="flex flex-col sm:flex-row gap-3">
            <input
              type="email"
              name="email_address"
              placeholder="Enter your email"
              required
              class="flex-1 px-4 py-3 rounded-lg border border-sage-200 focus:border-sage-400 focus:ring-2 focus:ring-sage-100 outline-none transition-colors"
            />
            <button
              type="submit"
              class="bg-sage-400 text-white px-6 py-3 rounded-lg font-semibold hover:bg-sage-500 transition-colors"
            >
              Subscribe
            </button>
          </div>
        </form>
        <p class="text-sm text-warmgray-400 mt-4">No spam, unsubscribe anytime.</p>
      </div>

    </div>
  </section>
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
